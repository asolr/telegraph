<html>
<head><title>Cape Cod Trace Route Project</title></head>
<body>
  <div id="mapdiv"></div>
  <script src="http://www.openlayers.org/api/OpenLayers.js"></script>
  <script>

// http://dev.openlayers.org/examples/draw-feature.html

  // http://dev.openlayers.org/examples/

/* sample data type from telegraph.py

[{'sdev': 1.9021599999999999, 'min': 8.61, 'importance': 0.325, 'ip': ['96.120.65.101'], 'address': u'Mashpee, Barnstable County, Massachusetts, 02649, United States of America', 'times': [8.61, 9.332, 9.738, 13.184, 13.195], 'host': ['96.120.65.101'], 'max': 13.195, 'lat': 41.6162, 'lng': -70.4931, 'avg': 10.8118}, {'sdev': 0.3321599999999997, 'min': 13.0, 'importance': 0.325, 'ip': ['68.87.154.77'], 'address': u'Mashpee, Barnstable County, Massachusetts, 02649, United States of America', 'times': [14.038, 13.0, 13.0, 13.0, 13.0], 'host': ['te-9-5-ur02.mashpee.ma.boston.comcast.net'], 'max': 14.038, 'lat': 41.6162, 'lng': -70.4931, 'avg': 13.2076}, {'sdev': 1.7760800000000014, 'min': 13.302, 'importance': 0.325, 'ip': ['68.85.37.93'], 'address': u'Mashpee, Barnstable County, Massachusetts, 02649, United States of America', 'times': [19.768, 15.097, 15.059, 13.413, 13.302], 'host': ['be-113-ar01.needham.ma.boston.comcast.net'], 'max': 19.768, 'lat': 41.6162, 'lng': -70.4931, 'avg': 15.327800000000002}, {'sdev': 0.13567999999999927, 'min': 24.019, 'importance': 0.325, 'ip': ['68.86.90.217'], 'address': u'Mashpee, Barnstable County, Massachusetts, 02649, United States of America', 'times': [24.019, 24.214, 24.455, 24.155, 24.369], 'host': ['be-7015-cr01.newyork.ny.ibone.comcast.net'], 'max': 24.455, 'lat': 41.6162, 'lng': -70.4931, 'avg': 24.242399999999996}, {'sdev': 0.20208000000000012, 'min': 28.687, 'importance': 0.325, 'ip': ['68.86.85.25'], 'address': u'Mashpee, Barnstable County, Massachusetts, 02649, United States of America', 'times': [28.866, 29.203, 29.153, 28.718, 28.687], 'host': ['be-10102-cr02.ashburn.va.ibone.comcast.net'], 'max': 29.203, 'lat': 41.6162, 'lng': -70.4931, 'avg': 28.925400000000003}, {'sdev': 2.1282400000000004, 'min': 21.644, 'importance': 0.325, 'ip': ['68.86.85.70'], 'address': u'Mashpee, Barnstable County, Massachusetts, 02649, United States of America', 'times': [26.493, 28.149, 28.519, 28.839, 21.644], 'host': ['he-0-14-0-0-pe07.ashburn.va.ibone.comcast.net'], 'max': 28.839, 'lat': 41.6162, 'lng': -70.4931, 'avg': 26.7288}]

*/

  var lon = 41.618116;
  var lat = -70.485361;

  // GOOGLE TRACE ROUTE EXAMPLE
  //var locations = [[lat,lon], [-77.3861, 38.9695], [-122.0574, 37.4192], [-122.0574, 37.4192], [-122.0574, 37.4192]];
  // FACEBOOK TRACE ROUTE EXAMPLE:
  //var locations = [[lat,lon], [-77.3861, 38.9695], [-122.1781, 37.459], [-122.1781, 37.459], [-122.1781, 37.459], [-122.1781, 37.459], [-122.1826, 37.3762], [-122.1781, 37.459], [-122.1826, 37.3762], [-122.1826, 37.3762], [-122.1826, 37.3762]];
  // Marine Biological Labratory Cape Cod, MA
  //var locations = [[lat,lon], [-77.3861, 38.9695], [-75.4083, 40.0548], [-75.4083, 40.0548], [-75.4083, 40.0548]];
  // Ubuntu UK
  var locations = [[lat,lon], [-77.3861, 38.9695], [-0.13, 51.5], [-0.13, 51.5], [-0.13, 51.5], [-0.0931, 51.5142]]
  map = new OpenLayers.Map("mapdiv");
  map.addLayer(new OpenLayers.Layer.OSM());

  var fromProjection = new OpenLayers.Projection("EPSG:4326");   // Transform from WGS 1984
  var toProjection   = new OpenLayers.Projection("EPSG:900913"); // to Spherical Mercator Projection
  var center         = new OpenLayers.LonLat(lon, lat).transform(fromProjection, toProjection);

  // http://wiki.openstreetmap.org/wiki/Zoom_levels
  var zoom=1;
  map.setCenter (center, zoom);

  // Add the Markers Layer
  var markers = new OpenLayers.Layer.Vector("Markers Overlay");
  for (var l = 0; l < locations.length; l++){
    var feature = new OpenLayers.Feature.Vector(
      new OpenLayers.Geometry.Point( locations[l][0], locations[l][1] ).transform(fromProjection, toProjection),
      {description:"Longitude: " + locations[l][0] + " Latitude: " + locations[l][1]} ,
      {externalGraphic: 'marker.png', graphicHeight: 25, graphicWidth: 21, graphicXOffset:-12, graphicYOffset:-25  }
    );
    markers.addFeatures(feature);
  }
  map.addLayer(markers);

  //http://dev.openlayers.org/docs/files/OpenLayers/Geometry/LineString-js.html#OpenLayers.Geometry.LineString
  // All lines to the Map
  var lines = new OpenLayers.Layer.Vector("Lines Overlay");
  var coordinates = [];
  for (var i = 0; i < locations.length; i++) {
    coordinates.push(new OpenLayers.Geometry.Point(locations[i][0], locations[i][1]).transform(fromProjection, toProjection));
  }
  var feature = new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString(coordinates));
  lines.addFeatures(feature);
  map.addLayer(lines);

  //Add a selector control to the vectorLayer with popup functions
  var controls = {
    selector: new OpenLayers.Control.SelectFeature(markers, { onSelect: createPopup, onUnselect: destroyPopup })
  };

  function createPopup(feature) {
    feature.popup = new OpenLayers.Popup.FramedCloud("pop",
    feature.geometry.getBounds().getCenterLonLat(),
    null,
    '<div class="markerContent">'+feature.attributes.description+'</div>',
    null,
    true,
    function() { controls['selector'].unselectAll(); }
  );
  //feature.popup.closeOnMove = true;
  map.addPopup(feature.popup);
}

function destroyPopup(feature) {
  feature.popup.destroy();
  feature.popup = null;
}

map.addControl(controls['selector']);
//map.addControl(new OpenLayers.Control.MousePosition());
controls['selector'].activate();

</script>

</body>
</html>
